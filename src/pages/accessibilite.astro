---
import Layout from "../layouts/Layout.astro";
import CarteXP from "../components/CarteXP.astro";
import garesAvecActivitesData from "../assets/garesAvecActivites.json";
import * as d3 from "d3";

const garesValides = garesAvecActivitesData.filter((d) => d.nombrePOI != null);
const nombreGares = garesValides.length;
const totalPOI = d3.sum(garesValides, (d) => d.nombrePOI);
const moyennePOI = d3.mean(garesValides, (d) => d.nombrePOI);
const topGares = garesValides
    .sort((a, b) => b.nombrePOI - a.nombrePOI)
    .slice(0, 5);
---

<Layout title="Accessibilit√© touristique">
    <section class="py-12 px-6 lg:px-20 bg-base-100 text-base-content">
        <div class="container mx-auto max-w-8xl text-center">
            <h1
                class="text-4xl lg:text-6xl font-extrabold mb-8 text-base-content"
            >
                Accessibilit√© touristique par le train
            </h1>

            <div
                class="inline-block bg-primary/10 border border-primary/30 px-6 py-3 rounded-2xl mb-8"
            >
                <p
                    class="text-xl lg:text-2xl font-semibold text-info-content italic"
                >
                    ¬´ D√©couvrez le potentiel touristique accessible depuis
                    chaque gare fran√ßaise ¬ª
                </p>
            </div>

            <p class="text-xl lg:text-2xl leading-relaxed">
                Cette analyse r√©v√®le les zones o√π le train rend le
                <span class="font-semibold text-primary"
                    >tourisme accessible</span
                > et dense.
                <br /> Explorez les gares qui ouvrent les portes vers les tr√©sors
                de France.
            </p>

            <div class="mt-14 flex flex-wrap justify-center gap-4 text-lg">
                <a
                    href="#statistiques"
                    class="inline-flex items-center gap-3 px-4 py-2 rounded-lg bg-primary/10 border border-primary/30 text-primary font-medium shadow-sm transition-transform hover:scale-105"
                >
                    <span class="text-xl lg:text-2xl">üìä</span>
                    <span>Statistiques cl√©s</span>
                </a>

                <a
                    href="#top-gares"
                    class="inline-flex items-center gap-3 px-4 py-2 rounded-lg bg-secondary/10 border border-secondary/30 text-secondary font-medium shadow-sm transition-transform hover:scale-105"
                >
                    <span class="text-xl lg:text-2xl">üèÜ</span>
                    <span>Top gares</span>
                </a>

                <a
                    href="#carte"
                    class="inline-flex items-center gap-3 px-4 py-2 rounded-lg bg-accent/10 border border-accent/30 text-accent font-medium shadow-sm transition-transform hover:scale-105"
                >
                    <span class="text-xl lg:text-2xl">üó∫Ô∏è</span>
                    <span>Carte interactive</span>
                </a>
            </div>
        </div>
    </section>

    <section
        id="statistiques"
        class="bg-primary/10 py-10 border-t border-primary/30"
    >
        <div class="container mx-auto px-6 lg:px-20">
            <div class="mb-12 text-center">
                <h2
                    class="text-2xl lg:text-4xl font-bold text-base-content mb-6"
                >
                    Vue d'ensemble du r√©seau ferroviaire touristique
                </h2>
                <p class="text-lg lg:text-xl mx-auto">
                    Chiffres cl√©s sur l'accessibilit√© touristique par le train
                    en France
                </p>
            </div>

            <div class="alert alert-info shadow-lg mb-8">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    class="stroke-current shrink-0 w-6 h-6"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                </svg>
                <div>
                    <h3 class="font-bold text-white">
                        √Ä propos de cette analyse
                    </h3>
                    <div class="text-sm text-white">
                        Cette carte r√©v√®le les zones o√π le train rend le
                        tourisme accessible et dense. Chaque point repr√©sente
                        une gare, sa taille et sa couleur indiquent le nombre
                        d'activit√©s touristiques accessibles dans un rayon de 10
                        km.
                    </div>
                </div>
            </div>

            <div
                class="stats stats-vertical lg:stats-horizontal shadow w-full mb-8"
            >
                <div class="stat bg-base-100">
                    <div class="stat-figure text-primary">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            class="inline-block w-8 h-8 stroke-current"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div class="stat-title">Gares analys√©es</div>
                    <div class="stat-value text-primary">{nombreGares}</div>
                    <div class="stat-desc">Sur tout le territoire</div>
                </div>

                <div class="stat bg-base-100">
                    <div class="stat-figure text-secondary">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            class="inline-block w-8 h-8 stroke-current"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
                            ></path>
                        </svg>
                    </div>
                    <div class="stat-title">Points d'int√©r√™t totaux</div>
                    <div class="stat-value text-secondary">
                        {totalPOI.toLocaleString("fr-FR")}
                    </div>
                    <div class="stat-desc">Activit√©s touristiques</div>
                </div>

                <div class="stat bg-base-100">
                    <div class="stat-figure text-accent">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            class="inline-block w-8 h-8 stroke-current"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                            ></path>
                        </svg>
                    </div>
                    <div class="stat-title">Moyenne par gare</div>
                    <div class="stat-value text-accent">
                        {moyennePOI?.toFixed(1)}
                    </div>
                    <div class="stat-desc">POI accessibles</div>
                </div>

                <div class="stat bg-base-100">
                    <div class="stat-figure text-warning">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            class="inline-block w-8 h-8 stroke-current"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                            ></path>
                        </svg>
                    </div>
                    <div class="stat-title">Top gare</div>
                    <div class="stat-value text-warning text-2xl">
                        {topGares[0]?.nombrePOI}
                    </div>
                    <div class="stat-desc">{topGares[0]?.nom}</div>
                </div>
            </div>
        </div>
    </section>

    <section
        id="top-gares"
        class="bg-secondary/10 py-24 border-t border-secondary/30"
    >
        <div class="container mx-auto px-6 lg:px-20">
            <div class="mb-12 text-center">
                <h2
                    class="text-3xl lg:text-5xl font-bold text-base-content mb-6"
                >
                    üèÜ Top 5 des gares les plus attractives
                </h2>
                <p class="text-lg lg:text-xl mx-auto">
                    Les gares fran√ßaises offrant le plus de points d'int√©r√™t
                    touristiques
                </p>
            </div>

            <div
                class="bg-base-100 rounded-3xl shadow-lg p-6 lg:p-10 hover:shadow-xl transition-all duration-300"
            >
                <div class="overflow-x-auto">
                    <table class="table table-zebra">
                        <thead>
                            <tr>
                                <th>Rang</th>
                                <th>Gare</th>
                                <th>R√©gion</th>
                                <th>Points d'int√©r√™t</th>
                            </tr>
                        </thead>
                        <tbody>
                            {
                                topGares.map((gare, index) => (
                                    <tr>
                                        <th>
                                            {index === 0
                                                ? "ü•á"
                                                : index === 1
                                                  ? "ü•à"
                                                  : index === 2
                                                    ? "ü•â"
                                                    : index + 1}
                                        </th>
                                        <td class="font-semibold">
                                            {gare.nom}
                                        </td>
                                        <td>{gare.region}</td>
                                        <td>
                                            <div class="badge badge-primary badge-lg">
                                                {gare.nombrePOI} POI
                                            </div>
                                        </td>
                                    </tr>
                                ))
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <section id="carte" class="bg-accent/10 py-24 border-t border-accent/30">
        <div class="container mx-auto px-6 lg:px-20 max-w-7xl">
            <div class="mb-12 text-center">
                <h2
                    class="text-3xl lg:text-5xl font-bold text-base-content mb-6"
                >
                    üó∫Ô∏è Carte interactive de l'accessibilit√© touristique
                </h2>
                <p class="text-lg lg:text-xl mx-auto">
                    Explorez la r√©partition des points d'int√©r√™t accessibles par
                    le train sur tout le territoire
                </p>
            </div>

            <div
                class="bg-base-100 rounded-3xl shadow-lg p-6 lg:p-10 hover:shadow-xl transition-all duration-300"
            >
                <CarteXP />
            </div>
        </div>
    </section>

    <section
        class="relative py-24 bg-gradient-to-r from-primary to-secondary/60 text-white"
    >
        <div
            class="container mx-auto px-6 lg:px-20 flex flex-col items-center text-center"
        >
            <div
                class="max-w-3xl backdrop-blur-lg bg-white/10 rounded-3xl p-10 shadow-2xl border border-white/20"
            >
                <h2 class="text-4xl font-bold mb-6">
                    Explorer l'attractivit√© des r√©gions
                </h2>
                <p class="text-lg text-white/90 leading-relaxed">
                    Maintenant que vous connaissez l'accessibilit√©, d√©couvrez
                    quelles r√©gions offrent la meilleure densit√© de points
                    d'int√©r√™t par gare.
                </p>
                <a
                    href="/attractivite"
                    class="mt-8 btn btn-lg btn-neutral shadow-lg hover:shadow-xl transition-all"
                >
                    Voir l'attractivit√© des r√©gions ‚Üí
                </a>
            </div>
        </div>
    </section>
</Layout>
